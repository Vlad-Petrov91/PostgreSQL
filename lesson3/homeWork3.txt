1)
ALTER TABLE users
ADD CONSTRAINT users_main_photo_id_fk
FOREIGN KEY (main_photo_id)
REFERENCES photo (id);

ALTER TABLE messages
ADD CONSTRAINT messages_from_user_id_fk
FOREIGN KEY (from_user_id)
REFERENCES users (id);

ALTER TABLE messages
ADD CONSTRAINT messages_to_user_id_fk
FOREIGN KEY (to_user_id)
REFERENCES users (id)
ON DELETE CASCADE;

ALTER TABLE friendship
ADD CONSTRAINT friendship_requested_by_user_id_fk
FOREIGN KEY (requested_by_user_id)
REFERENCES users (id)
ON DELETE CASCADE;

ALTER TABLE friendship
ADD CONSTRAINT friendship_requested_to_user_id_fk
FOREIGN KEY (requested_to_user_id)
REFERENCES users (id)
ON DELETE CASCADE;

ALTER TABLE friendship
ADD CONSTRAINT friendship_status_id_fk
FOREIGN KEY (status_id)
REFERENCES friendship_statuses (id);

ALTER TABLE communities 
ADD CONSTRAINT communities_creator_id_fk
FOREIGN KEY (creator_id)
REFERENCES users (id)
ON DELETE CASCADE;

ALTER TABLE communities_users 
ADD CONSTRAINT communities_users_user_id_fk
FOREIGN KEY (user_id)
REFERENCES users (id);

ALTER TABLE communities_users 
ADD CONSTRAINT communities_users_community_id_fk
FOREIGN KEY (community_id)
REFERENCES communities (id)
ON DELETE CASCADE;

ALTER TABLE photo 
ADD CONSTRAINT photo_owner_id_fk
FOREIGN KEY (owner_id)
REFERENCES users (id)
ON DELETE CASCADE;

ALTER TABLE video 
ADD CONSTRAINT video_owner_id_fk
FOREIGN KEY (owner_id)
REFERENCES users (id)
ON DELETE CASCADE;

ALTER TABLE subscriptions
ADD CONSTRAINT subscription_type_id_fk
FOREIGN KEY (subscription_type_id)
REFERENCES subscription_type (id);

ALTER TABLE subscriptions 
ADD CONSTRAINT subscriptions_user_id_fk
FOREIGN KEY (user_id)
REFERENCES users (id)
ON DELETE CASCADE;

2)
https://cloud.mail.ru/public/qCcA/H5J5fhEGc

3)
ALTER TABLE photo ADD COLUMN metadata JSON;
UPDATE photo SET metadata = json_build_object (
'id', id,
'url', url,
'size', size
);

4)
ALTER TABLE communities ADD COLUMN members INT[];
UPDATE communities SET members = (SELECT ARRAY_AGG(user_id) FROM communities_users WHERE community_id = 3) WHERE id = 3;
SELECT members FROM communities WHERE id = 3;

5)
CREATE TYPE contacts AS (email VARCHAR(120), phone VARCHAR(15));
ALTER TABLE users ADD COLUMN user_contacts contacts;
UPDATE users SET user_contacts = (users.email, users.phone);
UPDATE users SET user_contacts.email = 'test@somemail.ru' WHERE id = 21;
